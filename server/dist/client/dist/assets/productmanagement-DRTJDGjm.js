import{n as z,H as B,w as G,I as J,r as a,a6 as K,a7 as V,_ as o,j as e,m as W}from"./index-BGOJMzyI.js";import{S as m}from"./skeleton-ChRZPoLm.js";import{A as X}from"./AdminSidebar-D7NXFRCM.js";import"./index-BP06CEvy.js";import"./index-9w_9ind6.js";const re=()=>{const{user:i}=z(t=>t.userReducer),g=B(),y=G(),{data:s,isLoading:I,error:d}=J(g.id),{photos:S,category:N,name:x,price:j,stock:l,description:F}=(s==null?void 0:s.product)||{photos:["","","",""],category:"",name:"",price:0,stock:0,_id:"",description:""},[u,P]=a.useState(void 0),[p,w]=a.useState(void 0),[v,k]=a.useState(x),[f,U]=a.useState(N),[_,C]=a.useState(S),[E,H]=a.useState([]),[D,R]=a.useState(null),[n,h]=a.useState(!1),[b,A]=a.useState(F),[L]=K(),[M]=V(),$=t=>{const r=t.target.files;if(r){const c=Array.from(r),Q=c.map(T=>URL.createObjectURL(T));H(c),C(Q)}},q=async t=>{t.preventDefault(),h(!0);const r=new FormData;v&&r.set("name",v),u&&r.set("price",u.toString()),p!==void 0&&r.set("stock",p.toString()),f&&r.set("category",f),b&&r.set("description",b),E.forEach(c=>{r.append("photos",c)});try{(await L({formData:r,userId:i==null?void 0:i._id,productId:s==null?void 0:s.product._id})).error?o.error("Failed to update product."):o.success("Product updated successfully!")}catch{o.error("An error occurred while updating the product.")}finally{h(!1)}},O=async()=>{h(!0);try{(await M({userId:i==null?void 0:i._id,productId:s==null?void 0:s.product._id})).error?o.error("Failed to delete product."):(o.success("Product deleted successfully!"),y("/admin/product"))}catch{o.error("An error occurred while deleting the product.")}finally{h(!1)}};return a.useEffect(()=>{if(s&&(k(s.product.name),P(s.product.price),w(s.product.stock),C(s.product.photos),U(s.product.category),A(s.product.description)),d){const t=d.status;if(t===404||t===400){o.error("Product not found."),y("/404");return}const r=d.data.message;D!==r&&(o.error(r),R(r))}},[s,d,D]),e.jsxs("div",{className:"admin-container",children:[e.jsx(X,{}),e.jsx("main",{className:"product-management",children:I?e.jsxs("div",{className:"skeleton-loader",children:[e.jsx(m,{height:200,width:400,className:"skeleton-img"}),e.jsx(m,{height:30,width:800,className:"skeleton-text"}),e.jsx(m,{height:30,width:850,className:"skeleton-text"}),e.jsx(m,{height:30,width:800,className:"skeleton-text"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsxs("strong",{children:["ID - ",g.id?g.id:"loading..."]}),e.jsx("div",{className:"image-preview-container",children:e.jsx("img",{className:"main-image-preview",src:S[0],alt:"Product"})}),e.jsx("p",{children:x}),l>0?e.jsxs("span",{className:"green",children:[l," Available"]}):e.jsx("span",{className:"red",children:" Not Available"}),e.jsxs("h3",{children:["â‚¹",j]})]}),e.jsxs("article",{children:[e.jsx("button",{className:"product-delete-btn",style:{backgroundColor:n?"gray":"",cursor:n?"not-allowed":"pointer"},onClick:O,disabled:n,children:e.jsx(W,{})}),e.jsxs("form",{onSubmit:q,children:[e.jsx("h2",{children:"Manage Product"}),e.jsxs("div",{children:[e.jsx("label",{children:"Name"}),e.jsx("input",{type:"text",placeholder:x||"Name",value:v,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{required:!0,placeholder:"Description",value:b,onChange:t=>A(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Price"}),e.jsx("input",{type:"number",placeholder:j===0?"Price":j.toString(),value:u===void 0?"":u,onChange:t=>P(Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Stock"}),e.jsx("input",{type:"number",placeholder:l===0?"Stock":l.toString(),value:p===void 0?"":p,onChange:t=>w(Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Category"}),e.jsx("input",{type:"text",placeholder:N||"e.g., laptop, camera etc.",value:f,onChange:t=>U(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Photos"}),e.jsx("input",{type:"file",multiple:!0,onChange:$})]}),e.jsx("div",{className:"image-preview-container",children:_.map((t,r)=>e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:t,alt:`Preview ${r}`})},r))}),e.jsx("button",{className:`${n?"button-disabled":""}`,type:"submit",disabled:n,children:"Update"})]})]})]})})]})};export{re as default};
