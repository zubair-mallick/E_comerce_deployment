import{j as e,L as m,m as I,n as N,r as l,d as b,o as C,p as y,q as g,t as j,_ as f,f as E,v as q}from"./index-CnNG6d7V.js";import{a as $}from"./index-DVNnl1o_.js";const V=({cartItem:o,addToCartHandler:u,removeFromCartHandler:c})=>{const{productId:r,photos:i,name:n,price:t,quantity:d}=o;return console.log(r,i,n,t,d),e.jsxs("div",{className:"cart-item",children:[e.jsx(m,{to:`/product/${r}`,children:e.jsx("img",{src:i[0],alt:n})}),e.jsxs("article",{children:[e.jsx(m,{to:`/product/${r}`,children:n}),e.jsxs("span",{children:["â‚¹",t]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>c(o),children:"-"}),e.jsx("p",{children:d}),e.jsx("button",{onClick:()=>u(o),children:"+"})]}),e.jsx("button",{onClick:()=>c({...o,quantity:0}),children:e.jsx(I,{})})]})},O=()=>{const{cartItems:o,subtotal:u,tax:c,total:r,shippingCharges:i,discount:n}=N(s=>s.cartReducer),[t,d]=l.useState(""),[v,p]=l.useState(!0),a=b();l.useEffect(()=>{const{token:s,cancel:h}=C.CancelToken.source(),S=setTimeout(()=>{t&&C.get(`${y}/api/v1/payment/discount?coupon=${t}`,{cancelToken:s}).then(x=>{a(g(x.data.discount)),p(!0),localStorage.setItem("couponCode",t),a(j())}).catch(x=>{p(!1),a(g(0)),a(j()),f.error(x.response.data.message||"server error")})},1e3);return()=>{h(),clearTimeout(S),p(!1)}},[t]);const k=s=>{if(s.quantity>=s.stock){f.error("Out of Stock");return}a(E(s))},T=s=>{a(q(s))};return l.useEffect(()=>{a(j())},[o,a]),e.jsxs("div",{className:"cart",children:[e.jsx("main",{children:o.length>0?o.map((s,h)=>(console.log("ðŸ¥³",s),e.jsx(V,{cartItem:s,removeFromCartHandler:T,addToCartHandler:k},h))):e.jsx("h1",{children:"No Items Added"})}),e.jsxs("aside",{children:[e.jsxs("p",{children:["Subtotatal:â‚¹",u," "]}),e.jsxs("p",{children:["Shipping Charges:â‚¹",i," "]}),e.jsxs("p",{children:["Tax:â‚¹",c," "]}),e.jsxs("p",{children:["discount:",e.jsx("em",{className:n<=0?"":"red",children:n<=0?"â‚¹0":"-â‚¹"+n})]}),e.jsxs("p",{children:["total:â‚¹",r]}),e.jsx("input",{type:"text",placeholder:"Coupon Code",value:t,onChange:s=>d(s.target.value)}),t&&(v?e.jsxs("span",{className:"green",children:["â‚¹",n," off using the code: ",e.jsx("code",{children:t})," "]}):e.jsxs("span",{className:"red",children:["Invalid coupon ",e.jsx($,{})]})),o.length>0&&e.jsx(m,{to:"/shipping",children:"Checkout"})]})]})};export{O as default};
